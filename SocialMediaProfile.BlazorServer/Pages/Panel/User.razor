@page "/{alias}"
@inject IGlobalWebService GlobalWebService;
@inject IUserWebService UserWebService;
@inject UserAuthenticationStateProvider AuthStateProvider;

<Banner></Banner>

<section class="aboutme text-white position-relative" style="padding-bottom: 9rem; background: #212529;">
    <article class="container">
        <div class="row">
            <div class="col">
                <PersonalInfo Alias="@(Alias)"></PersonalInfo>
            </div>
        </div>
    </article>
    <article class="position-absolute bottom-0 w-100" style="margin-bottom: -1.50rem; height: 9.5rem; overflow: hidden;">
        <svg viewBox="0 0 500 150" preserveAspectRatio="none" style="height: 100%; width: 100%;">
            <path d="M-59.59,56.59 C228.21,229.81 -91.19,19.19 571.33,108.75 L500.00,149.60 L-1.46,151.07 Z" style="stroke: none; fill: #1A1C1D;"></path>
        </svg>
    </article>
</section>

<section class="text-white position-relative" style="padding-top: 6rem; padding-bottom: 10rem; background:#1A1C1D;">
    <article class="container">
        <div id="tecnologías" class="row">
            @*ASIDE*@
            <article class="col-3 d-flex flex-column justify-content-center row-gap-5">
                <div class="card text-bg-dark" style="height: 15%;">
                    <img src="paisaje1.jpg" class="card-img object-fit-cover h-100 rounded-4" alt="img">
                    <div class="card-img-overlay d-flex justify-content-center align-items-center">
                        <h3 class="card-title">Mi CV</h3>
                    </div>
                </div>
                <div class="card text-bg-dark" style="height: 15%;">
                    <img src="paisaje2.jpg" class="card-img object-fit-cover h-100 rounded-4" alt="img">
                    <div class="card-img-overlay d-flex justify-content-center align-items-center">
                        <h3 class="card-title">Mi GitHub</h3>
                    </div>
                </div>
                <div class="card text-bg-dark" style="height: 20%;">
                    <img src="paisaje3.jpg" class="card-img object-fit-cover h-100 rounded-4" alt="img">
                    <div class="card-img-overlay d-flex justify-content-center align-items-center">
                        <h3 class="card-title">Mis Certificaciones</h3>
                    </div>
                </div>
                <div class="card text-bg-dark" style="height: 30%;">
                    <img src="paisaje4.jpg" class="card-img object-fit-cover h-100 rounded-4" alt="img">
                    <div class="card-img-overlay d-flex justify-content-center align-items-center" style="height: 404px;">
                        <h3 class="card-title">Mis Colegas</h3>
                    </div>
                </div>
            </article>
            @*MAIN*@
            <article class="col-9 ps-5">
                <Skills Alias="@(Alias)"></Skills>
                <Experiences Alias="@(Alias)"></Experiences>
                <Educations Alias="@(Alias)"></Educations>
            </article>
        </div>
    </article>
    <article class="position-absolute bottom-0 w-100" style="margin-bottom: -1.50rem; height: 9.5rem; overflow: hidden;">
        <svg viewBox="0 0 500 150" preserveAspectRatio="none" style="height: 100%; width: 100%;">
            <path d="M-59.59,56.59 C228.21,229.81 -91.19,19.19 571.33,108.75 L500.00,149.60 L-1.46,151.07 Z" style="stroke: none; fill: #212529;"></path>
        </svg>
    </article>
</section>

<section class="bg-projects" style="padding-top: 7rem; padding-bottom: 8rem; padding-bottom: 8rem;">
    <article class="container">
        <div id="proyectos" class="row">
            <div class="col">
                <Projects Alias="@(Alias)"></Projects>
            </div>
        </div>
    </article>
</section>

@code {
    [Parameter]
    public string Alias { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await Task.CompletedTask;

        if (string.IsNullOrEmpty(AuthStateProvider.CurrentRole))
        {
            return;
        }

        if (AuthStateProvider.CurrentRole.Equals("Admin"))
        {
            if (!AuthStateProvider.CurrentAlias.Equals(Alias))
            {
                var user = await UserWebService.GetByAliasAsync(Alias);
                GlobalWebService.UserId = user.Id;
            }
            else
            {
                GlobalWebService.UserId = AuthStateProvider.CurrentUserId;
            }
        }
        else
        {
            if (AuthStateProvider.CurrentAlias.Equals(Alias))
            {
                GlobalWebService.UserId = AuthStateProvider.CurrentUserId;
            }
        }
    }
}
